#!/usr/bin/env ruby

command, file_name = ARGV.first&.split(':')
require_relative '../rubee.rb'
Rubee::Autoload.call

if command == 'run'
  Object.const_get(file_name.split("_").map(&:capitalize).join).new.call
elsif command == 'init'
  begin
    DB = Sequel.connect(Rubee::Configuration.get_database_url)
  rescue => _
    DB = Sequel.connect(Rubee::Configuration.get_database_url.gsub(/(\/test|\/development|\/production)/, ''))
    DB.run("CREATE DATABASE #{ENV['RACK_ENV']}")
  end
else
  puts "Unknown command: #{command}"
end

